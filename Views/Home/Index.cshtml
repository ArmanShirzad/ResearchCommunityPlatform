@model PublicationsViewModel

@{
    ViewData["Title"] = "Home Page";
}

<link href="~/css/SwiperJs.css" rel="stylesheet" />

<link href="~/swiper/swiper.min.css" rel="stylesheet" />
<script src="~/swiper/swiper.min.js"></script>
<!-- Featured Communities Slider -->

<section class="container mx-auto mt-8">
    <h2 class="text-3xl font-bold mb-4">Featured communities</h2>

    <!-- Swiper container -->
    <div class="swiper-container">
        <!-- Additional required wrapper -->
        <div class="swiper-wrapper">
            <!-- Slides -->
            <div class="swiper-slide">
                <img src="~/Content/data1.jpg" alt="Community" />
                <div class="text-content">
                    <h3 class="text-xl font-bold text-gray-700">Get Maximum Productiviy for your Research project collaborate and review publications</h3>
                    <p class="text-sm mb-2 text-gray-600"> project assembles the largest and most diverse research...</p>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Browse Archive</button>
                </div>
            </div>
            <!-- Repeat for more slides -->
            <div class="swiper-slide">
                <img src="~/Content/Slider2.jpg" alt="research" />
                <div class="text-content">
                    <h3 class="text-xl font-bold text-gray-700">Get Real Time Statistics with Scopus and Web of Science </h3>
                    <p class="text-sm mb-2 text-gray-600"> Research Geek Stays in touch with real time analysis of trending topics from popular world archives</p>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover\:bg-orange-500">Try Demo</button>
                </div>
            </div>

        </div>
        <!-- Navigation buttons -->
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>

        <!-- Pagination -->
        <div class="swiper-pagination"></div>



    </div>

</section>

<div id="publicationsList" class="container mx-auto mt-8">
    <h2 class="text-3xl font-bold mb-4">Recent uploads</h2>
    @foreach (var publication in Model.Publications)
    {
        <div class="publication-record bg-white shadow rounded p-4 mb-4" data-id="@publication.PublicationId">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm text-gray-600">
                    Uploaded on @publication.UploadDate
                </span>
                <span class="status-tag bg-green-200 text-green-800 text-xs px-2 py-1 rounded">
                    @publication.PubType
                </span>
            </div>
            <h3 class="publication-title text-lg font-bold mb-1">
                <a asp-action="GetPublicationById" asp-route-id="@publication.PublicationId">
                    @publication.Title
                </a>
            </h3>
            <p class="publication-authors text-sm mb-1">
                <strong>Authors:</strong>
                @(publication.Authors != null ? string.Join(", ", publication.Authors) : "No authors listed")
            </p>
            <p class="publication-doi text-sm mb-1">
                DOI: @publication.DOI
            </p>
            <p class="publication-description text-sm">
                @publication.Description
            </p>
            <div class="flex items-center mt-2">
                <span class="download-count text-gray-700 text-sm mr-4">
                    <i class="fa fa-download mr-1"></i> 32
                </span>
                <span class="like-count text-gray-700 text-sm">
                    <i class="fa fa-thumbs-up mr-1"></i> 1
                </span>
            </div>
        </div>
    }

    <div class="text-center my-8">
        <button id="showMoreBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded" data-lastid="@Model.Publications.LastOrDefault()?.PublicationId">
            Show More
        </button>
    </div>

</div>



<script>
    var swiper = new Swiper('.swiper-container', {
        // Optional parameters
        direction: 'horizontal',
        loop: true,

        // If you want to use pagination
        pagination: {
            el: '.swiper-pagination',
        },

        // Navigation arrows
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },

        // And if you want to add scrollbar

    });

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('showMoreBtn').addEventListener('click', function () {
            var lastPublicationId = this.getAttribute('data-lastid');
            fetch(`/Home/LoadMorePublications?lastLoadedId=${lastPublicationId}`)
                .then(response => response.text())
                .then(html => {
                    if (html.trim()) {
                        document.getElementById('publicationsList').insertAdjacentHTML('beforeend', html);

                        // Update the lastPublicationId stored in "Show More" button
                        var newLastPublicationId = document.querySelector('#publicationsList .publication-record:last-child').getAttribute('data-id');
                        this.setAttribute('data-lastid', newLastPublicationId);

                        document.getElementById('showMoreBtn').style.display = 'none';
                    }
                })
                .catch(error => console.error('Error loading more publications:', error));
        });
    });



</script>